<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Cart</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #007bff;
        }
        .cartItem {
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
        }
        img {
            max-width: 80px;
            margin-right: 15px;
            border-radius: 4px;
        }
        .bottomNavbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #dee2e6;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .emptyMessage {
            text-align: center;
            font-size: 1.2em;
            color: #777;
        }
    </style>
</head>
<body>
    <div class="cartContainer">
        <h1>Your Cart</h1>
        <div id="cartItems"></div>
    </div>

    <div class="bottomNavbar">
        <button id="backButton">Back to Shopping</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getDatabase, ref as dbRef, get, child } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBDrzrgLslaJvnXbo1e90irCEtdcm9ZsCU",
            authDomain: "logins-13661.firebaseapp.com",
            databaseURL: "https://logins-13661-default-rtdb.firebaseio.com",
            projectId: "logins-13661",
            storageBucket: "logins-13661.appspot.com",
            messagingSenderId: "451535349483",
            appId: "1:451535349483:web:d3c9867fd2bffbbdca40ae",
            measurementId: "G-DWP16WX2H7"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        function getCartIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        async function loadCart(cartId) {
            try {
                const snapshot = await get(child(dbRef(database), 'carts/' + cartId));
                if (snapshot.exists()) {
                    const cartData = snapshot.val().cart;
                    displayCartItems(cartData);
                } else {
                    document.getElementById('cartItems').innerHTML = '<p class="emptyMessage">No cart data found.</p>';
                }
            } catch (error) {
                console.error("Error loading cart:", error);
            }
        }

        function displayCartItems(cartItems) {
            const cartItemsContainer = document.getElementById('cartItems');
            cartItemsContainer.innerHTML = '';

            if (!cartItems || cartItems.length === 0) {
                cartItemsContainer.innerHTML = '<p class="emptyMessage">Your cart is empty.</p>';
                return;
            }

            cartItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cartItem';
                itemDiv.innerHTML = 
                    `<div>
                        <strong>${item.itemName}</strong><br>
                        Price: ZAR ${item.itemPrice}<br>
                        <a href="${item.catalogLink}" target="_blank">View Catalog</a>
                    </div>
                    <div>
                        ${item.images.map(img => `
                            <img src="${img.file}" alt="Image">
                            <div>Design: ${img.design}</div>
                        `).join('')}
                    </div>`;
                cartItemsContainer.appendChild(itemDiv);
            });
        }

        const cartId = getCartIdFromUrl();
        if (cartId) {
            loadCart(cartId);
        }

        document.getElementById('backButton').addEventListener('click', () => {
            window.history.back();
        });
    </script>
</body>
</html>
